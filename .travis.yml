language: python


before_install:
  - wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh
  - bash miniconda.sh -b -p $HOME/miniconda
  - export PATH="$HOME/miniconda/bin:$PATH"
  - hash -r
  - conda config --set always_yes yes --set changeps1 no
  - conda update -q conda  # get latest conda version
  - conda info -a

install:
  - sudo apt-get install -qq libopencv-dev

  - conda create --yes -n test python=3.7 pip numpy swig gxx_linux-64
  - source activate test

script:
  - which gcc
  - which g++
  - g++ --version
  # avoid cmake & make for the momement, they slow down the test so much
  # - mkdir build
  # - cd build
  # - cmake ..
  # - make
  # - cd ..
  # - ./build/merlict-test

  # - echo "trying out one_source.py"
  - ./one_source.py
  - g++ merlict_test.cpp merlict.cpp -o merlict_test -O1
  - ./merlict_test

  - swig -c++ -python -o merlict_wrap.cpp merlict.i
  - python setup.py build_ext --inplace
  - pip install -e .
  - pytest
